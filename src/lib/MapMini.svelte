<script context="module">
	export const router = true
</script>


<script>

import { geoPath, geoMercator, scaleThreshold } from "d3";
import Wards from "../data/wards.geo.json";
import Fourdata from "../data/fourData.geo.json";

export let parameter;
export let colours;

  const geoJSONData = {
    access_cool: {
      data: Fourdata,
	  breaks: [248, 368, 516, 728, 2750],
	  field: "cool_access",
    },
    access_hospital: {
      data: Fourdata,
      breaks: [135, 202, 284, 413, 2221],
	  field: "hospital_access",
    },
    canopy_cover: {
      data: Fourdata,
      breaks: [0.14, 0.21, 0.27, 0.35, 0.74],
	  field: "canopy_per",
    },
    impervious_percentage: {
      data: Fourdata,
      breaks: [0.48, 0.55, 0.62, 0.71, 1],
	  field: "imper_per",
    },
  };

const selectedGeoJSON = geoJSONData[parameter];
console.log(selectedGeoJSON)
let divWidth = 420;
  $: innerWidth = divWidth;
  $: height = innerWidth / 1.75;

  // Update the projection and path based on your requirements
  $: projection = geoMercator()
    .center([-78.155 - 0.00239 * innerWidth + 0.000001125 * innerWidth ** 2, 43.54 + 0.00045 * innerWidth - 2.5e-7 * innerWidth ** 2])
    .scale([82000 * innerWidth / 800])
    .angle([-17]);
  $: path = geoPath(projection);

	let da = selectedGeoJSON.data.features;

	var color = scaleThreshold()
	.domain(selectedGeoJSON.breaks)
	.range(colours);

	da.map((item) => {
	item.properties[selectedGeoJSON.field]
		? (item.properties["color_" + selectedGeoJSON.field] = color(item.properties[selectedGeoJSON.field]))
		: (item.properties["color_" + selectedGeoJSON.field] = "white");
	});
	console.log(da)
</script>


<div bind:offsetWidth={divWidth}>
    <svg width={innerWidth} {height} id={selectedGeoJSON.data.name}>

		<text class="label" x="12" y="22">{geoJSONData[parameter].name + " "  + " of the vote citywide)"}</text>

		{#each da as data}
			<path class="da" d={path(data)} fill={data.properties["color_" + parameter]} />
		{/each}

		{#each Wards.features as data}
			<path class="wardwhite" d={path(data)} />
		{/each}

		{#each Wards.features as data}
			<path class="ward" d={path(data)} />
		{/each}

		<text class="label" x="310" y="185">total</text>
		<text class="label" x="310" y="200">count</text>
		<text class="label" x="373" y="170">{geoJSONData[parameter]["breaks"][3]}</text>
		<text class="label" x="373" y="185">{geoJSONData[parameter]["breaks"][2]}</text>
		<text class="label" x="373" y="200">{geoJSONData[parameter]["breaks"][1]}</text>
		<text class="label" x="373" y="215">{geoJSONData[parameter]["breaks"][0]}</text>
		
		<rect class="box" width="20" height = "15" x="350" y="150" style="fill:{colours[4]}; stroke: white;"></rect>
		<rect class="box" width="20" height = "15" x="350" y="165" style="fill:{colours[3]}; stroke: white;"></rect>
		<rect class="box" width="20" height = "15" x="350" y="180" style="fill:{colours[2]}; stroke: white;"></rect>
		<rect class="box" width="20" height = "15" x="350" y="195" style="fill:{colours[1]}; stroke: white;"></rect>
		<rect class="box" width="20" height = "15" x="350" y="210" style="fill:{colours[0]}; stroke: white;"></rect>

	</svg>
</div>



<style>

	#fm-back {
		stroke: rgb(0, 0, 0);
		stroke-width: 5px;
		opacity: 0.08;
		fill-opacity: 0;
	}
	.da {
		stroke: rgb(237, 237, 237);
		stroke-width: 1px;
		opacity: 0.9;
	}
	.ward {
		stroke: black;
		stroke-width: 1px;
		fill: none;
	}
	.wardwhite {
		stroke: white;
		stroke-width: 0px;
		fill: none;
	}

	#fm {
		stroke: rgb(36, 36, 36);
		stroke-width: 1 px;
		fill-opacity: 0;
	}

	.label {
		font-size: 13px;
		fill: rgb(56, 56, 56);
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
			Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
	}
</style>