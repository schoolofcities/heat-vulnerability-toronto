<script>

	import { onMount } from 'svelte';
	import maplibregl from 'maplibre-gl';
	import * as pmtiles from 'pmtiles';
	import layers from 'protomaps-themes-base';
    import { geoPath, geoMercator, scaleThreshold } from "d3";
    import Wards from "../data/wards.geo.json";
    import SubwayLines from "../data/subwayLines.geo.json";
    import SubwayStns from "../data/subwayStations.geo.json";
    import '../routes/styles.css';
    

	let map;
	let PMTILES_URL = "/heat-vulnerability-toronto/toronto.pmtiles";

	let protocol = new pmtiles.Protocol();
	maplibregl.addProtocol('pmtiles', protocol.tile);


	onMount(() => {
		map = new maplibregl.Map({
			container: 'map',
			style: './vector-tiles-vintage-v5.json',
			center: [-79.36, 43.715],
			zoom: 10.5, 
			minZoom: 9,
			maxZoom: 13,
			bearing: -17,
			maxBounds:[ 
				[-80.28, 43.21], 
				[-77.88, 44.91] 
			],
			projection: 'globe',
			scrollZoom: true,
			attributionControl: false,
			showZoom: true,
		});

		map.addSource('protomaps', {
			type: "vector",
			url: "pmtiles://" + PMTILES_URL,
			attribution: 'Â© <a href="https://openstreetmap.org">OpenStreetMap</a>'
		});

		let protoLayers = layers("protomaps","light");

		protoLayers.forEach(e => {
			map.addLayer(e);
		});

        map.addSource('subway-lines', {
        type: 'geojson',
        data: SubwayLines,
        });

        map.addLayer({
        id: 'subway-lines-layer',
        type: 'line',
        source: 'subway-lines',
        paint: {
            'line-color': '#A4303F',
            'line-width': 2,
        },
        });

        map.addSource('subway-stations', {
        type: 'geojson',
        data: SubwayStns,
        });

        map.addLayer({
            id: 'subway-stations-layer',
            type: 'circle',
            source: 'subway-stations',
            paint: {
                'circle-color': '#C8D6AF',
                'circle-radius': 3,
            },
	    });
    });
</script>